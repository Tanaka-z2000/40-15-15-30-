<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>40/15/15/30 æ™ºæ…§å†å¹³è¡¡åŠ©æ‰‹</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel CDNs -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* é‡å°æ‰‹æ©Ÿè¼¸å…¥æ¡†å„ªåŒ– */
        input[type="number"] {
            font-size: 16px !important; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        const App = () => {
            const [values, setValues] = useState({
                v662: '',
                v631L: '',
                v670L: '',
                cash: ''
            });

            // å®šç¾© 40/15/15/30 ç›®æ¨™
            const TARGETS = {
                t662: 0.40,
                t631L: 0.15,
                t670L: 0.15,
                cash: 0.30
            };

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setValues(prev => ({ ...prev, [name]: value }));
            };

            const report = useMemo(() => {
                const v662 = parseFloat(values.v662) || 0;
                const v631L = parseFloat(values.v631L) || 0;
                const v670L = parseFloat(values.v670L) || 0;
                const cash = parseFloat(values.cash) || 0;
                
                const totalWealth = v662 + v631L + v670L + cash;
                if (totalWealth <= 0) return null;

                const currentRatios = {
                    '00662': { ratio: v662 / totalWealth, amount: v662 },
                    '00631L': { ratio: v631L / totalWealth, amount: v631L },
                    '00670L': { ratio: v670L / totalWealth, amount: v670L },
                    'cash': { ratio: cash / totalWealth, amount: cash }
                };

                // æ ¸å¿ƒé‚è¼¯ï¼š00662 åªå¢ä¸æ¸› (æˆ–ç¶­æŒç›®æ¨™)ï¼Œå…¶é¤˜éƒ¨åˆ†æŒ‰æ¯”ä¾‹å†å¹³è¡¡
                const targetV662Base = totalWealth * TARGETS.t662;
                const finalV662 = Math.max(v662, targetV662Base); 
                
                const remainingWealth = totalWealth - finalV662;
                const liquidWeightTotal = TARGETS.t631L + TARGETS.t670L + TARGETS.cash; 
                
                const final631L = remainingWealth * (TARGETS.t631L / liquidWeightTotal);
                const final670L = remainingWealth * (TARGETS.t670L / liquidWeightTotal);
                const finalCash = remainingWealth * (TARGETS.cash / liquidWeightTotal);

                const post = {
                    v662: { ratio: finalV662 / totalWealth, amount: finalV662, diff: finalV662 - v662 },
                    v631L: { ratio: final631L / totalWealth, amount: final631L, diff: final631L - v631L },
                    v670L: { ratio: final670L / totalWealth, amount: final670L, diff: final670L - v670L },
                    cash: { ratio: finalCash / totalWealth, amount: finalCash, diff: finalCash - cash }
                };

                let actions = [];
                const sellActions = [];
                const buyActions = [];

                if (post.v631L.diff < -1) sellActions.push(`è³£å‡º 00631Lï¼š$${Math.abs(Math.round(post.v631L.diff)).toLocaleString()}`);
                if (post.v670L.diff < -1) sellActions.push(`è³£å‡º 00670Lï¼š$${Math.abs(Math.round(post.v670L.diff)).toLocaleString()}`);
                if (post.cash.diff < -1) sellActions.push(`æé ˜ç¾é‡‘ï¼š$${Math.abs(Math.round(post.cash.diff)).toLocaleString()}`);

                if (post.v662.diff > 1) buyActions.push(`è²·å…¥ 00662ï¼š$${Math.round(post.v662.diff).toLocaleString()}`);
                if (post.v631L.diff > 1) buyActions.push(`è²·å…¥ 00631Lï¼š$${Math.round(post.v631L.diff).toLocaleString()}`);
                if (post.v670L.diff > 1) buyActions.push(`è²·å…¥ 00670Lï¼š$${Math.round(post.v670L.diff).toLocaleString()}`);
                if (post.cash.diff > 1) buyActions.push(`ç•™å­˜ç¾é‡‘ï¼š$${Math.round(post.cash.diff).toLocaleString()}`);

                actions = [...sellActions, ...buyActions];
                return { totalWealth, currentRatios, actions, post };
            }, [values]);

            return (
                <div className="min-h-screen pb-12">
                    {/* Header */}
                    <header className="bg-white border-b sticky top-0 z-20 px-4 py-3 flex items-center justify-between shadow-sm">
                        <div className="flex items-center gap-2">
                            <div className="bg-blue-600 text-white px-2 py-1 rounded-lg flex items-center justify-center font-black text-[10px] shadow-sm leading-none text-center">
                                40/15/<br/>15/30
                            </div>
                            <h1 className="text-lg font-bold text-slate-800 tracking-tight">å†å¹³è¡¡åŠ©æ‰‹</h1>
                        </div>
                        {report && (
                            <div className="text-right">
                                <p className="text-[10px] font-bold text-slate-400 uppercase leading-none mb-1">Total Assets</p>
                                <p className="text-sm font-black text-blue-600">${Math.round(report.totalWealth).toLocaleString()}</p>
                            </div>
                        )}
                    </header>

                    <main className="px-4 py-6 space-y-8 max-w-md mx-auto">
                        {/* Input Section */}
                        <section className="space-y-4">
                            <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest px-1">è³‡ç”¢ç¾æ³è¼¸å…¥</h2>
                            <div className="grid grid-cols-2 gap-3">
                                {[
                                    { id: 'v662', label: '00662 å¸‚å€¼', icon: 'ğŸ“ˆ' },
                                    { id: 'cash', label: 'ç¾é‡‘é¡åº¦', icon: 'ğŸ’°' },
                                    { id: 'v631L', label: '00631L å¸‚å€¼', icon: 'âš¡' },
                                    { id: 'v670L', label: '00670L å¸‚å€¼', icon: 'ğŸ¦…' }
                                ].map(item => (
                                    <div key={item.id} className="bg-white p-3 rounded-2xl border border-slate-200 shadow-sm focus-within:border-blue-400 transition-colors">
                                        <label className="block text-[10px] font-bold text-slate-500 mb-1">{item.icon} {item.label}</label>
                                        <input 
                                            type="number" 
                                            name={item.id} 
                                            value={values[item.id]} 
                                            onChange={handleInputChange} 
                                            placeholder="0" 
                                            className="w-full bg-transparent border-none outline-none font-black text-lg text-slate-800 placeholder:text-slate-200"
                                        />
                                    </div>
                                ))}
                            </div>
                        </section>

                        {report ? (
                            <div className="space-y-8 animate-fade-in">
                                {/* Current Ratios */}
                                <section>
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest px-1 mb-3">ç›®å‰é…ç½®æ¯”ä¾‹</h2>
                                    <div className="grid grid-cols-2 gap-3">
                                        {Object.entries(report.currentRatios).map(([name, data]) => {
                                            const target = name === '00662' ? 0.4 : name === 'cash' ? 0.3 : 0.15;
                                            const diff = (data.ratio - target) * 100;
                                            return (
                                                <div key={name} className="bg-white p-4 rounded-2xl border border-slate-200 flex flex-col justify-between aspect-square shadow-sm">
                                                    <div>
                                                        <span className="text-[10px] font-black text-slate-400 uppercase">{name}</span>
                                                        <div className="text-2xl font-black text-slate-800">{(data.ratio * 100).toFixed(1)}%</div>
                                                    </div>
                                                    <div className={`text-[10px] font-bold px-2 py-1 rounded-lg w-fit ${Math.abs(diff) < 2 ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}`}>
                                                        {Math.abs(diff) < 2 ? 'ç¬¦åˆç›®æ¨™' : `${diff > 0 ? 'åé«˜' : 'åä½'} ${Math.abs(diff).toFixed(1)}%`}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>

                                {/* Action Steps */}
                                <section>
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest px-1 mb-3">å†å¹³è¡¡æ“ä½œæ¸…å–®</h2>
                                    <div className="bg-slate-900 rounded-3xl p-6 shadow-xl border-t-4 border-green-500">
                                        {report.actions.length > 0 ? (
                                            <div className="space-y-4">
                                                {report.actions.map((act, i) => (
                                                    <div key={i} className="flex gap-3 items-start border-b border-slate-800 pb-3 last:border-0 last:pb-0">
                                                        <span className="bg-slate-700 text-green-400 w-5 h-5 rounded flex items-center justify-center text-[10px] font-bold mt-0.5 shrink-0">{i+1}</span>
                                                        <span className="text-slate-100 text-sm font-bold leading-relaxed">{act}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <p className="text-slate-500 text-center text-sm py-4 italic font-bold">é…ç½®å®Œç¾ï¼Œç„¡éœ€èª¿æ•´</p>
                                        )}
                                    </div>
                                </section>

                                {/* Target Amounts - ç¢ºä¿æ­¤æ¨¡çµ„æ­£ç¢ºé¡¯ç¤º */}
                                <section>
                                    <h2 className="text-xs font-black text-slate-400 uppercase tracking-widest px-1 mb-3">é è¨ˆå†å¹³è¡¡å¾Œç›®æ¨™å¸‚å€¼</h2>
                                    <div className="space-y-3">
                                        {Object.entries(report.post).map(([key, data]) => {
                                            const label = key === 'v662' ? '00662' : key === 'v631L' ? '00631L' : key === 'v670L' ? '00670L' : 'Cash éƒ¨ä½';
                                            return (
                                                <div key={key} className="bg-white p-4 rounded-2xl border border-slate-200 flex justify-between items-center shadow-sm">
                                                    <div>
                                                        <div className="text-[10px] font-black text-slate-400 uppercase">{label}</div>
                                                        <div className="font-mono text-lg font-black text-slate-800 tracking-tighter">
                                                            ${Math.round(data.amount).toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-[9px] font-bold text-blue-600 px-2 py-0.5 bg-blue-50 rounded inline-block">ç›®æ¨™ {(data.ratio * 100).toFixed(0)}%</div>
                                                        <div className={`text-[10px] font-black mt-1 ${data.diff >= 0 ? 'text-green-600' : 'text-red-500'}`}>
                                                            {data.diff >= 0 ? `+ $${Math.abs(Math.round(data.diff)).toLocaleString()}` : `- $${Math.abs(Math.round(data.diff)).toLocaleString()}`}
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </section>
                            </div>
                        ) : (
                            <div className="text-center py-24 opacity-20">
                                <div className="text-6xl mb-4">âš–ï¸</div>
                                <p className="font-black text-slate-600">è¼¸å…¥è³‡ç”¢æ•¸æ“šé–‹å§‹å¹³è¡¡</p>
                            </div>
                        )}
                    </main>

                    <footer className="mt-8 text-center px-4">
                        <p className="text-[10px] font-black text-slate-300 uppercase tracking-[0.3em] mb-2">40/15/15/30 Strategy</p>
                        <p className="text-[9px] text-slate-400 leading-relaxed font-bold">
                            æœ¬åŠ©æ‰‹åƒ…ä¾›ç­–ç•¥åƒè€ƒï¼ŒæŠ•è³‡å‰è«‹å¯©æ…è©•ä¼°é¢¨éšªã€‚<br/>
                            å»ºè­°æ¯åŠå¹´è‡³ä¸€å¹´è‡³å°‘åŸ·è¡Œä¸€æ¬¡å†å¹³è¡¡ã€‚
                        </p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
